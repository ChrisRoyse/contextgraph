# TASK-M02-020: SuggestedAction Enum

## Task Metadata
| Field | Value |
|-------|-------|
| Task ID | TASK-M02-020 |
| Status | **✅ COMPLETE** |
| Layer | surface |
| Module | module-02 |
| Priority | high |
| Estimated Hours | 0.5 |
| Depends On | None (standalone enum) |
| Implements | TECH-CORE-002 Section 2.4, REQ-CORE-008 |
| Completed | 2025-12-31 |
| Verified By | Automated tests (9/9 pass), Clippy (0 warnings) |

---

## Status: VERIFIED COMPLETE

**All requirements already implemented and tested.** The SuggestedAction enum exists in `crates/context-graph-core/src/types/pulse.rs` and meets all specification requirements.

### Evidence of Completion

```
cargo test --package context-graph-core suggested_action
→ 9 tests passed, 0 failed

cargo clippy --package context-graph-core -- -D warnings
→ 0 warnings
```

---

## Actual Implementation (VERIFIED)

**File:** `crates/context-graph-core/src/types/pulse.rs` (lines 102-144)

### SuggestedAction Enum

```rust
#[derive(Debug, Clone, Copy, Default, Serialize, Deserialize, PartialEq, Eq, Hash)]
#[serde(rename_all = "snake_case")]
pub enum SuggestedAction {
    /// System ready for new input - low entropy, high coherence.
    Ready,
    /// Continue current activity - balanced state (DEFAULT).
    #[default]
    Continue,
    /// Explore new knowledge - use epistemic_action or trigger_dream(rem).
    Explore,
    /// Consolidate knowledge - use trigger_dream(nrem) or merge_concepts.
    Consolidate,
    /// Prune redundant information - review curation_tasks.
    Prune,
    /// Stabilize context - use trigger_dream or critique_context.
    Stabilize,
    /// Review context - use critique_context or reflect_on_memory.
    Review,
}

impl SuggestedAction {
    pub fn description(&self) -> &'static str {
        match self {
            Self::Ready => "System ready for new input - low entropy, high coherence",
            Self::Continue => "Continue current activity - balanced state",
            Self::Explore => "Explore new knowledge - use epistemic_action or trigger_dream(rem)",
            Self::Consolidate => "Consolidate knowledge - use trigger_dream(nrem) or merge_concepts",
            Self::Prune => "Prune redundant information - review curation_tasks",
            Self::Stabilize => "Stabilize context - use trigger_dream or critique_context",
            Self::Review => "Review context - use critique_context or reflect_on_memory",
        }
    }
}
```

### All Requirements Satisfied

| Requirement | Status | Evidence |
|-------------|--------|----------|
| 7 variants present | ✅ | Ready, Continue, Explore, Consolidate, Prune, Stabilize, Review |
| Default = Continue | ✅ | `#[default]` attribute on Continue variant |
| Serde snake_case | ✅ | `#[serde(rename_all = "snake_case")]` |
| Clone, Copy, Debug | ✅ | Derive macros |
| PartialEq, Eq, Hash | ✅ | Derive macros |
| description() method | ✅ | Returns MCP tool guidance strings |
| MCP tool guidance | ✅ | Descriptions include tool names like `epistemic_action`, `trigger_dream`, etc. |

### Tests Present (9 total)

1. `test_suggested_action_default_is_continue` - Verifies Default trait
2. `test_suggested_action_serde_roundtrip` - Serialization round-trip
3. `test_suggested_action_serde_snake_case` - Snake case JSON format
4. `test_suggested_action_descriptions_not_empty` - All descriptions > 20 chars
5. `test_suggested_action_descriptions_unique` - No duplicate descriptions
6. `test_suggested_action_copy_semantics` - Copy trait works
7. `test_suggested_action_hash` - HashSet deduplication
8. `test_suggested_action_invalid_serde_rejected` - Invalid variants rejected
9. `test_suggested_action_descriptions_contain_mcp_tools` - MCP tool guidance present

---

## File Paths (VERIFIED)

| File | Status |
|------|--------|
| `crates/context-graph-core/src/types/pulse.rs` | ✅ Contains complete implementation |
| `crates/context-graph-core/src/types/mod.rs` | ✅ Re-exports via `pub use pulse::*` |
| `crates/context-graph-core/src/lib.rs` | ✅ Accessible via `types::SuggestedAction` |

---

## Verification Commands (All Pass)

```bash
# Build check
cargo build --package context-graph-core
# → Success

# Run SuggestedAction tests
cargo test --package context-graph-core suggested_action -- --nocapture
# → 9 passed, 0 failed

# Run all pulse tests
cargo test --package context-graph-core pulse -- --nocapture
# → 15+ passed (includes CognitivePulse tests)

# Clippy check
cargo clippy --package context-graph-core -- -D warnings
# → 0 warnings
```

---

## Definition of Done: SATISFIED

- [x] All 7 variants present
- [x] Default returns Continue
- [x] Serde uses snake_case
- [x] Descriptions include MCP tool guidance
- [x] All 9 tests pass
- [x] 0 clippy warnings

---

## Action Decision Matrix Reference

From PRD Section 1.3, suggested actions map to entropy (E) and coherence (C):

| E | C | Action | MCP Tools |
|---|---|--------|-----------|
| >0.7 | >0.5 | Explore | `epistemic_action`, `trigger_dream(rem)` |
| >0.7 | <0.4 | Stabilize | `trigger_dream`, `critique_context` |
| <0.4 | >0.7 | Ready | Continue normal operation |
| <0.4 | <0.4 | Review | `get_neighborhood`, `critique_context` |
| 0.4-0.7 | 0.4-0.7 | Continue | Balanced state |

This decision logic is implemented in `CognitivePulse::compute_action()` (lines 77-94 of pulse.rs).

---

## NOT In Scope (Explicitly Excluded)

| Item | Why Excluded | Where Covered |
|------|--------------|---------------|
| EmotionalState enum | Separate type in types/utl.rs | TASK-M02-019 (COMPLETE) |
| CognitivePulse struct | Uses SuggestedAction, defined in pulse.rs | TASK-M02-021 |
| compute_suggested_action() | Business logic in CognitivePulse | TASK-M02-022 |

---

## Verification Report

```
=== TASK-M02-020 Verification Report ===
Date: 2025-12-31
Commit: Verified against current main branch

1. BUILD: cargo build --package context-graph-core [SUCCESS]
2. TESTS: cargo test --package context-graph-core suggested_action [9 passed, 0 failed]
3. CLIPPY: cargo clippy --package context-graph-core [0 warnings]

4. MANUAL VERIFICATION:
   - SuggestedAction::default() == Continue: VERIFIED
   - All 7 variants serialize to snake_case: VERIFIED
   - All descriptions contain MCP tool guidance: VERIFIED
   - Hash/Eq traits work correctly: VERIFIED

5. EDGE CASES:
   - Default trait: PASS
   - Invalid serde: PASS (rejected correctly)
   - HashSet dedup: PASS

=== TASK-M02-020 COMPLETE ===
```

---

*Task ID: TASK-M02-020*
*Module: 02 - Core Infrastructure*
*Layer: Surface*
*Completed: 2025-12-31*
