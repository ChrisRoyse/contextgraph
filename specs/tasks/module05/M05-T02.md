# M05-T02: Define SurpriseConfig for KL Divergence Parameters

```yaml
task:
  id: "M05-T02"
  title: "Define SurpriseConfig for KL Divergence Parameters"
  description: |
    Implement SurpriseConfig struct for surprise computation configuration.
    Fields: kl_weight (0.6), distance_weight (0.4), kl (KlConfig),
    context_window_size (50), context_decay (0.95), max_surprise_no_context (0.9),
    min_context_for_kl (3).
    KlConfig: epsilon (1e-10), max_kl_value (10.0), temperature (1.0).
    Constraint: kl_weight + distance_weight = 1.0.
  layer: "foundation"
  priority: "critical"
  estimated_hours: 1.5
  file_path: "crates/context-graph-utl/src/config.rs"
  dependencies: []
  acceptance_criteria:
    - "SurpriseConfig struct with 7 fields"
    - "KlConfig nested struct with 3 fields"
    - "Default returns spec-defined values"
    - "Weights sum to 1.0"
    - "Serde serialization works"
  test_file: "crates/context-graph-utl/tests/config_tests.rs"
  spec_refs:
    - "TECH-UTL-005 Section 10"
    - "SPEC-UTL-005 Section 3.3"
```

---

## Description

Implement SurpriseConfig struct for surprise computation configuration. Fields: kl_weight (0.6), distance_weight (0.4), kl (KlConfig), context_window_size (50), context_decay (0.95), max_surprise_no_context (0.9), min_context_for_kl (3). KlConfig: epsilon (1e-10), max_kl_value (10.0), temperature (1.0). Constraint: kl_weight + distance_weight = 1.0.

## Details

| Field | Value |
|-------|-------|
| **Layer** | foundation |
| **Priority** | critical |
| **Estimated Hours** | 1.5 |
| **File Path** | `crates/context-graph-utl/src/config.rs` |

## Dependencies

None - this is a foundational configuration task.

## Configuration Fields

### SurpriseConfig

| Field | Type | Default Value | Description |
|-------|------|---------------|-------------|
| `kl_weight` | f32 | 0.6 | Weight for KL divergence in ensemble |
| `distance_weight` | f32 | 0.4 | Weight for cosine distance in ensemble |
| `kl` | KlConfig | (see below) | KL divergence parameters |
| `context_window_size` | usize | 50 | Number of context embeddings to consider |
| `context_decay` | f32 | 0.95 | Decay factor for recency weighting |
| `max_surprise_no_context` | f32 | 0.9 | Surprise value when no context available |
| `min_context_for_kl` | usize | 3 | Minimum context vectors for KL computation |

### KlConfig

| Field | Type | Default Value | Description |
|-------|------|---------------|-------------|
| `epsilon` | f64 | 1e-10 | Numerical stability epsilon |
| `max_kl_value` | f32 | 10.0 | Maximum KL divergence for normalization |
| `temperature` | f32 | 1.0 | Softmax temperature |

## Constraints

- `kl_weight + distance_weight = 1.0`

## Acceptance Criteria

- [ ] SurpriseConfig struct with 7 fields
- [ ] KlConfig nested struct with 3 fields
- [ ] Default returns spec-defined values
- [ ] Weights sum to 1.0
- [ ] Serde serialization works

## Test File

`crates/context-graph-utl/tests/config_tests.rs`

## Specification References

- TECH-UTL-005 Section 10
- SPEC-UTL-005 Section 3.3
